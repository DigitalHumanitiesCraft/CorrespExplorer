<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CorrespExplorer - Interaktive Visualisierung von Korrespondenz-Metadaten">
    <title>CorrespExplorer - Visualisierung</title>
    <link rel="icon" type="image/png" href="assets/logo-no-background-no-text.png">

    <!-- MapLibre GL JS CSS -->
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" />

    <!-- noUiSlider CSS -->
    <link rel="stylesheet" href="https://unpkg.com/nouislider@15.7.1/dist/nouislider.min.css" />

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Core CSS -->
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/shadows.css">

    <!-- Page-specific CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/explore.css">
</head>
<body>
    <!-- Fullscreen Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner">
            <i class="fas fa-envelope fa-spin"></i>
        </div>
        <div class="loading-text">Lade Korrespondenzdaten...</div>
    </div>

    <!-- Simple Navigation for Explore -->
    <nav class="navbar" role="navigation" aria-label="Hauptnavigation">
        <div class="nav-brand">
            <a href="index.html" class="nav-brand-link">
                <i class="fas fa-arrow-left"></i>
                <span class="brand-text" id="dataset-title">CorrespExplorer</span>
            </a>
        </div>
        <div class="view-switcher" role="navigation" aria-label="Ansichtswechsel">
            <button class="view-btn active" data-view="map" aria-pressed="true" title="Karte">
                <i class="fas fa-map"></i> <span class="view-btn-text">Karte</span>
            </button>
            <button class="view-btn" data-view="persons" aria-pressed="false" title="Korrespondenten">
                <i class="fas fa-users"></i> <span class="view-btn-text">Korrespondenten</span>
            </button>
            <button class="view-btn" data-view="letters" aria-pressed="false" title="Briefe">
                <i class="fas fa-envelope"></i> <span class="view-btn-text">Briefe</span>
            </button>
            <button class="view-btn" data-view="timeline" aria-pressed="false" title="Timeline">
                <i class="fas fa-chart-line"></i> <span class="view-btn-text">Timeline</span>
            </button>
            <button class="view-btn" data-view="topics" aria-pressed="false" id="topics-view-btn" title="Themen">
                <i class="fas fa-tags"></i> <span class="view-btn-text">Themen</span>
            </button>
            <button class="view-btn" data-view="places" aria-pressed="false" id="places-view-btn" title="Orte">
                <i class="fas fa-map-marker-alt"></i> <span class="view-btn-text">Orte</span>
            </button>
            <button class="view-btn" data-view="network" aria-pressed="false" id="network-view-btn" title="Netzwerk">
                <i class="fas fa-project-diagram"></i> <span class="view-btn-text">Netzwerk</span>
            </button>
            <button class="view-btn" data-view="mentions-flow" aria-pressed="false" id="mentions-flow-view-btn" title="Mentions Flow">
                <i class="fas fa-diagram-project"></i> <span class="view-btn-text">Mentions Flow</span>
            </button>
        </div>
        <div class="nav-links">
            <button id="export-btn" class="nav-link" aria-label="Daten exportieren">
                <i class="fas fa-download"></i> <span class="nav-link-text">Export</span>
            </button>
            <a href="about.html" class="nav-link" title="About">
                <i class="fas fa-info-circle"></i>
                <span class="nav-link-text">About</span>
            </a>
            <a href="vault.html" class="nav-link" title="Promptotyping Vault">
                <i class="fas fa-book"></i>
                <span class="nav-link-text">Vault</span>
            </a>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <div class="content-wrapper">
            <!-- Sidebar -->
            <aside class="sidebar" role="complementary" aria-label="Datensatz und Filter">

                <!-- ========================================
                     SECTION 1: DATENSATZ (Kontext zuerst)
                     ======================================== -->
                <div class="sidebar-section" id="sidebar-dataset">
                    <div class="sidebar-section-header">
                        <h4>Datensatz</h4>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-value" id="total-letters-count">-</div>
                            <div class="stat-label">Briefe</div>
                            <span class="stat-quality-icon hidden" id="letters-quality-icon" title="">
                                <i class="fas fa-exclamation-circle"></i>
                            </span>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-senders-count">-</div>
                            <div class="stat-label">Absender</div>
                            <span class="stat-quality-icon hidden" id="senders-quality-icon" title="">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-places-count">-</div>
                            <div class="stat-label">Orte</div>
                            <span class="stat-quality-icon hidden" id="places-quality-icon" title="">
                                <i class="fas fa-map-marker-alt"></i>
                            </span>
                        </div>
                    </div>

                    <!-- Data Source & Coverage -->
                    <div class="dataset-meta">
                        <div class="dataset-source">
                            <i class="fas fa-database"></i>
                            <span id="source-info">Daten werden geladen...</span>
                        </div>
                        <div class="dataset-coverage" id="data-coverage-details">
                            <!-- Filled by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- ========================================
                     SECTION 2: FILTER (Interaktive Elemente)
                     ======================================== -->
                <div class="sidebar-section" id="sidebar-filters">
                    <div class="sidebar-section-header">
                        <h4>Filter</h4>
                        <button id="reset-filters" class="btn-reset-small" aria-label="Filter zuruecksetzen" title="Filter zuruecksetzen">
                            <i class="fas fa-undo"></i>
                        </button>
                    </div>

                    <!-- Active Filters Display -->
                    <div id="active-filters" class="active-filters hidden">
                        <!-- Filled by JavaScript when filters are active -->
                    </div>

                    <!-- Time Period Filter -->
                    <div class="filter-group" role="group" aria-labelledby="filter-time-heading">
                        <h5 id="filter-time-heading">Zeitraum</h5>
                        <div id="year-range-slider" aria-label="Jahr-Bereich waehlen" role="slider"></div>
                        <div class="year-range-display">
                            <span id="year-range-text">-</span>
                        </div>
                    </div>

                    <!-- Data Quality Filter -->
                    <div class="filter-group" role="group" aria-labelledby="filter-quality-heading" id="quality-filter-group">
                        <h5 id="filter-quality-heading">Datenqualitaet</h5>
                        <div class="quality-checkboxes">
                            <label class="filter-checkbox">
                                <input type="checkbox" id="filter-precise-dates">
                                <span>Nur exakte Datierungen</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" id="filter-known-persons">
                                <span>Nur identifizierte Personen</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" id="filter-located-places">
                                <span>Nur lokalisierte Orte</span>
                            </label>
                        </div>
                    </div>

                    <!-- Language Filter (dynamically populated) -->
                    <div class="filter-group hidden" role="group" aria-labelledby="filter-language-heading" id="language-filter-group">
                        <h5 id="filter-language-heading">Briefsprache</h5>
                        <div id="language-checkboxes"></div>
                    </div>

                    <!-- Topics Quick Filter (dynamically populated) -->
                    <div class="filter-group hidden" role="group" aria-labelledby="filter-topics-heading" id="topics-filter-group">
                        <h5 id="filter-topics-heading">Themen</h5>
                        <input type="search" id="topics-quick-search" class="topics-quick-search" placeholder="Thema suchen..." aria-label="Thema suchen">
                        <div id="topics-quick-filter" class="topics-quick-list"></div>
                        <a href="#" id="show-all-topics" class="show-all-link">Alle Themen anzeigen</a>
                    </div>

                    <!-- Mentions Flow Filter (view-specific) -->
                    <div class="filter-group hidden" role="group" aria-labelledby="filter-mentions-heading" id="mentions-filter-group">
                        <h5 id="filter-mentions-heading">Person waehlen</h5>
                        <div class="autocomplete-container">
                            <input type="search"
                                   id="mentions-person-search"
                                   class="autocomplete-input"
                                   placeholder="Name eingeben..."
                                   autocomplete="off"
                                   aria-label="Person suchen">
                            <div id="mentions-person-dropdown" class="autocomplete-dropdown hidden"></div>
                        </div>
                        <small class="filter-help">Waehle eine Person um ihre Mentions zu sehen</small>
                    </div>
                </div>

                <!-- ========================================
                     SECTION 3: LEGENDE (View-spezifisch)
                     ======================================== -->
                <div class="sidebar-section" id="sidebar-legend">
                    <div class="sidebar-section-header">
                        <h4>Legende</h4>
                    </div>

                    <!-- Map legend -->
                    <div id="legend-map" class="legend-content">
                        <div class="legend-item">
                            <span class="legend-color" aria-hidden="true"></span>
                            <span>Absendeort (Groesse = Briefanzahl)</span>
                        </div>
                        <p class="legend-hint">Klick auf Marker zeigt Details</p>
                    </div>

                    <!-- Letters legend (date precision) -->
                    <div id="legend-letters" class="legend-content hidden">
                        <div class="legend-item">
                            <i class="fas fa-arrows-alt-h color-info"></i>
                            <span>Zeitraum (notBefore/notAfter)</span>
                        </div>
                        <div class="legend-item">
                            <i class="fas fa-calendar-alt color-warning"></i>
                            <span>Nur Jahr/Monat bekannt</span>
                        </div>
                        <div class="legend-item">
                            <i class="fas fa-question-circle color-error"></i>
                            <span>Unsichere Datierung</span>
                        </div>
                        <p class="legend-hint"><a href="about.html#data-quality">Mehr zur Datenqualitaet</a></p>
                    </div>

                    <!-- Timeline legend -->
                    <div id="legend-timeline" class="legend-content hidden">
                        <div class="legend-item">
                            <span class="legend-hatched-small"></span>
                            <span>Anteil mit unscharfem Datum</span>
                        </div>
                        <p class="legend-hint">Hover zeigt Details pro Jahr</p>
                    </div>

                    <!-- Persons legend -->
                    <div id="legend-persons" class="legend-content hidden">
                        <div class="legend-item">
                            <span class="legend-color legend-role-sender"></span>
                            <span>Nur Absender</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color legend-role-receiver"></span>
                            <span>Nur Empfaenger</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color legend-role-both"></span>
                            <span>Beides</span>
                        </div>
                        <div class="legend-item">
                            <svg viewBox="0 0 30 20" width="14" height="10">
                                <rect fill="#990000" width="6" height="20"/>
                                <rect fill="#339966" x="8" width="6" height="20"/>
                                <rect fill="#006699" x="16" width="6" height="20"/>
                            </svg>
                            <span>Wikidata-Anreicherung</span>
                        </div>
                        <p class="legend-hint">Klick filtert nach Person</p>
                    </div>

                    <!-- Topics legend -->
                    <div id="legend-topics" class="legend-content hidden">
                        <div class="legend-item">
                            <i class="fas fa-circle color-primary"></i>
                            <span>Anzahl = Briefhaeufigkeit</span>
                        </div>
                        <p class="legend-hint">Klick zeigt Kookkurrenzen</p>
                    </div>

                    <!-- Places legend -->
                    <div id="legend-places" class="legend-content hidden">
                        <div class="legend-item">
                            <i class="fas fa-map-marker-alt color-primary"></i>
                            <span>Mit Koordinaten</span>
                        </div>
                        <div class="legend-item">
                            <i class="fas fa-map-marker-alt color-text-light"></i>
                            <span>Ohne Koordinaten</span>
                        </div>
                        <p class="legend-hint">Klick filtert nach Ort</p>
                    </div>

                    <!-- Network legend -->
                    <div id="legend-network" class="legend-content hidden">
                        <div class="legend-item">
                            <span class="legend-color legend-network-sender"></span>
                            <span>Absender</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color legend-network-receiver"></span>
                            <span>Empfaenger</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-line"></span>
                            <span>Korrespondenz (Staerke = Anzahl)</span>
                        </div>
                        <p class="legend-hint">Drag zum Verschieben, Scroll zum Zoomen</p>
                    </div>
                </div>

            </aside>

            <!-- Main Content -->
            <main class="main-content" role="main">
                <!-- Map View -->
                <div id="map-view" class="tab-content active">
                    <div id="map" role="application" aria-label="Interaktive Karte der Korrespondenz"></div>
                    <div class="map-controls">
                        <button id="layer-switcher" class="map-control-btn" title="Kartenlayer wechseln">
                            <i class="fas fa-sun"></i>
                        </button>
                        <button id="map-color-toggle" class="map-control-btn" title="Einheitliche Farbe verwenden">
                            <i class="fas fa-palette"></i>
                        </button>
                    </div>
                    <div id="map-legend" class="map-legend">
                        <div class="map-legend-title">Sprache</div>
                        <div class="map-legend-items"></div>
                    </div>
                </div>

                <!-- Persons View -->
                <div id="persons-view" class="tab-content">
                    <div class="list-header">
                        <input type="search" id="person-search" class="list-search" placeholder="Korrespondent suchen..." aria-label="Korrespondent suchen">
                        <div class="list-sort">
                            <label for="person-sort">Sortieren:</label>
                            <select id="person-sort">
                                <option value="letters-desc">Briefe (absteigend)</option>
                                <option value="letters-asc">Briefe (aufsteigend)</option>
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="name-desc">Name (Z-A)</option>
                            </select>
                        </div>
                    </div>
                    <div id="persons-list" class="entity-list"></div>
                </div>

                <!-- Letters View -->
                <div id="letters-view" class="tab-content">
                    <div class="list-header">
                        <input type="search" id="letter-search" class="list-search" placeholder="Brief suchen..." aria-label="Brief suchen">
                        <div class="list-sort">
                            <label for="letter-sort">Sortieren:</label>
                            <select id="letter-sort">
                                <option value="date-desc">Datum (neueste)</option>
                                <option value="date-asc">Datum (aelteste)</option>
                                <option value="sender-asc">Absender (A-Z)</option>
                            </select>
                        </div>
                    </div>
                    <div id="letters-list" class="entity-list"></div>
                </div>

                <!-- Timeline View -->
                <div id="timeline-view" class="tab-content">
                    <div class="timeline-container">
                        <div class="timeline-header">
                            <h3>Zeitliche Verteilung der Korrespondenz</h3>
                            <p class="timeline-info">Klicken Sie auf ein Sprach-Segment, um nach Jahr und Sprache zu filtern.</p>
                        </div>
                        <div class="timeline-main">
                            <div id="timeline-chart" class="timeline-chart"></div>
                            <div id="timeline-undated-bin" class="timeline-undated-bin hidden">
                                <span class="undated-bin-count"></span>
                                <div class="undated-bin-bar"></div>
                                <span class="undated-bin-label">k.A.</span>
                                <div class="undated-bin-tooltip"></div>
                            </div>
                        </div>
                        <div class="timeline-footer">
                            <div id="timeline-stack-legend" class="timeline-stack-legend"></div>
                            <span class="timeline-total" id="timeline-total"></span>
                        </div>
                    </div>
                </div>

                <!-- Topics View -->
                <div id="topics-view" class="tab-content">
                    <div class="entity-container">
                        <div class="entity-header">
                            <h3>Themen der Korrespondenz</h3>
                            <p>Klicken Sie auf ein Thema, um Details zu sehen und zu filtern</p>
                        </div>
                        <div class="entity-split-layout">
                            <!-- Topics List -->
                            <div class="entity-list-panel">
                                <div class="list-header">
                                    <input type="search" id="topic-search" class="list-search" placeholder="Thema suchen..." aria-label="Thema suchen">
                                    <div class="list-sort">
                                        <label for="topic-sort">Sortieren:</label>
                                        <select id="topic-sort">
                                            <option value="count-desc">Anzahl (absteigend)</option>
                                            <option value="count-asc">Anzahl (aufsteigend)</option>
                                            <option value="name-asc">Name (A-Z)</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="topics-list" class="entity-list"></div>
                            </div>
                            <!-- Topic Detail Panel -->
                            <div class="entity-detail-panel" id="topic-detail-panel">
                                <div class="entity-detail-empty" id="topic-detail-empty">
                                    <i class="fas fa-hand-pointer"></i>
                                    <p>Waehlen Sie ein Thema aus der Liste</p>
                                </div>
                                <div class="hidden" id="topic-detail-content">
                                    <div class="entity-detail-header">
                                        <h4 id="topic-detail-title">Thema</h4>
                                        <span class="entity-detail-count" id="topic-detail-count">0 Briefe</span>
                                    </div>
                                    <div class="entity-detail-section">
                                        <h5>Korrespondenten</h5>
                                        <div id="topic-correspondents"></div>
                                    </div>
                                    <div class="entity-detail-section">
                                        <h5>Zeitliche Verteilung</h5>
                                        <div id="topic-timeline" class="entity-mini-timeline"></div>
                                    </div>
                                    <div class="entity-detail-section">
                                        <h5>Verwandte Themen</h5>
                                        <div id="topic-related" class="entity-tags"></div>
                                    </div>
                                    <div class="entity-detail-actions">
                                        <button class="btn btn-primary" id="topic-filter-btn">
                                            <i class="fas fa-filter"></i> Briefe filtern
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Places View -->
                <div id="places-view" class="tab-content">
                    <div class="entity-container">
                        <div class="entity-header">
                            <h3>Absendeorte der Korrespondenz</h3>
                            <p>Klicken Sie auf einen Ort, um Details zu sehen und zu filtern</p>
                        </div>

                        <!-- Missing Coordinates Banner -->
                        <div id="places-missing-coords-banner" class="info-banner hidden" style="margin-bottom: 1rem;">
                            <i class="fas fa-info-circle"></i>
                            <div class="info-banner-content">
                                <strong><span id="places-missing-count">0</span> Orte ohne Koordinaten</strong>
                                <p>Diese Orte erscheinen nicht auf der Karte.</p>
                            </div>
                            <button id="resolve-coords-btn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-globe"></i> Koordinaten nachladen
                            </button>
                        </div>

                        <div class="entity-split-layout">
                            <!-- Places List -->
                            <div class="entity-list-panel">
                                <div class="list-header">
                                    <input type="search" id="place-search" class="list-search" placeholder="Ort suchen..." aria-label="Ort suchen">
                                    <div class="list-sort">
                                        <label for="place-sort">Sortieren:</label>
                                        <select id="place-sort">
                                            <option value="count-desc">Briefe (absteigend)</option>
                                            <option value="count-asc">Briefe (aufsteigend)</option>
                                            <option value="name-asc">Name (A-Z)</option>
                                            <option value="name-desc">Name (Z-A)</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="places-list" class="entity-list"></div>
                            </div>
                            <!-- Place Detail Panel -->
                            <div class="entity-detail-panel" id="place-detail-panel">
                                <div class="entity-detail-empty" id="place-detail-empty">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <p>Waehlen Sie einen Ort aus der Liste</p>
                                </div>
                                <div class="hidden" id="place-detail-content">
                                    <div class="entity-detail-header">
                                        <h4 id="place-detail-title">Ort</h4>
                                        <span class="entity-detail-count" id="place-detail-count">0 Briefe</span>
                                    </div>
                                    <div class="entity-detail-section">
                                        <h5>Top Absender</h5>
                                        <div id="place-top-senders"></div>
                                    </div>
                                    <div class="entity-detail-section">
                                        <h5>Zeitliche Verteilung</h5>
                                        <div id="place-timeline" class="entity-mini-timeline"></div>
                                    </div>
                                    <div class="entity-detail-section">
                                        <h5>Sprachen</h5>
                                        <div id="place-languages" class="entity-tags"></div>
                                    </div>
                                    <div class="entity-detail-actions">
                                        <button class="btn btn-primary" id="place-filter-btn">
                                            <i class="fas fa-filter"></i> Briefe filtern
                                        </button>
                                        <a id="place-geonames-link" href="#" target="_blank" class="btn btn-secondary">
                                            <i class="fas fa-external-link-alt"></i> GeoNames
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Network View -->
                <div id="network-view" class="tab-content">
                    <div class="network-container">
                        <div class="network-header">
                            <h3>Netzwerk-Analyse</h3>
                            <p class="network-info" id="network-info-text">Korrespondenten die in denselben Jahren aktiv sind</p>
                        </div>
                        <div class="network-controls">
                            <div class="network-control-group">
                                <label for="network-type">Netzwerk-Typ:</label>
                                <select id="network-type">
                                    <option value="contemporaries">Zeitgenossen</option>
                                </select>
                            </div>
                            <div class="network-control-group network-slider-group">
                                <label for="network-threshold" id="network-threshold-label">Min. gemeinsame Jahre:</label>
                                <input type="range" id="network-threshold" value="3" min="1" max="50" class="network-slider">
                                <span id="network-threshold-value" class="slider-value">3</span>
                            </div>
                            <div class="network-control-group">
                                <label for="network-max-nodes">Max. Knoten:</label>
                                <input type="number" id="network-max-nodes" value="50" min="10" max="200">
                            </div>
                            <div class="network-control-group" id="network-color-group">
                                <label for="network-color-mode">Farbe:</label>
                                <select id="network-color-mode">
                                    <option value="type">Nach Typ</option>
                                    <option value="entry">Nach Eintrittsjahr</option>
                                </select>
                            </div>
                            <div class="network-control-group" id="network-ego-group">
                                <label class="checkbox-inline">
                                    <input type="checkbox" id="network-hide-ego"> Ego ausblenden
                                </label>
                            </div>
                            <button id="network-reset-zoom" class="btn btn-secondary btn-sm">
                                <i class="fas fa-compress-arrows-alt"></i> Zoom zuruecksetzen
                            </button>
                        </div>
                        <div class="network-stats">
                            <span><i class="fas fa-circle"></i> <span id="network-node-count">0</span> Knoten</span>
                            <span><i class="fas fa-arrows-alt-h"></i> <span id="network-edge-count">0</span> Verbindungen</span>
                        </div>
                        <div class="network-coverage" id="network-coverage"></div>
                        <div id="network-graph" class="network-graph"></div>
                        <div class="network-legend" id="network-legend">
                            <div class="legend-item">
                                <span class="legend-circle legend-network-contemporary"></span> Zeitgenossen-Netzwerk
                            </div>
                            <div class="legend-hint">Klick auf Knoten filtert Briefe | Hover fuer Details</div>
                        </div>
                    </div>
                </div>

                <!-- Mentions Flow View -->
                <div id="mentions-flow-view" class="tab-content">
                    <div class="mentions-flow-container">
                        <div class="mentions-flow-header">
                            <h3>Erwaehnungs-Fluesse</h3>
                            <p class="mentions-flow-info">Visualisiert wer in wessen Briefen erwaehnt wird</p>
                            <p class="mentions-flow-selected-person" id="mentions-flow-selected-person"></p>
                        </div>
                        <div id="mentions-flow-graph" class="mentions-flow-graph"></div>
                        <div class="content-placeholder" id="mentions-flow-placeholder">
                            <i class="fas fa-user-circle"></i>
                            <p>Waehle eine Person in der Sidebar um deren Erwaehnungen zu sehen</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Daten exportieren</h3>
                <button class="modal-close" aria-label="Schliessen">&times;</button>
            </div>
            <div class="modal-body">
                <p>Exportiere die aktuell gefilterten Daten:</p>
                <div class="export-options">
                    <button class="export-option" data-format="csv">
                        <i class="fas fa-file-csv"></i>
                        <span>CSV</span>
                        <small>Tabellenformat</small>
                    </button>
                    <button class="export-option" data-format="json">
                        <i class="fas fa-file-code"></i>
                        <span>JSON</span>
                        <small>Strukturierte Daten</small>
                    </button>
                </div>
                <p class="export-info" id="export-info"></p>
            </div>
        </div>
    </div>

    <!-- Letter Detail Modal -->
    <div id="letter-modal" class="modal hidden">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="letter-modal-title">Brief-Details</h3>
                <button class="modal-close" aria-label="Schliessen">&times;</button>
            </div>
            <div class="modal-body" id="letter-modal-body">
                <!-- Content filled by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Person Detail Modal -->
    <div id="person-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="person-modal-title">Person</h3>
                <button class="modal-close" aria-label="Schliessen">&times;</button>
            </div>
            <div class="modal-body" id="person-modal-body">
                <!-- Content filled by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Missing Places Modal -->
    <div id="missing-places-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Orte ohne Koordinaten</h3>
                <button class="modal-close" aria-label="Schliessen">&times;</button>
            </div>
            <div class="modal-body" id="missing-places-body">
                <!-- Content filled by JavaScript -->
            </div>
        </div>
    </div>


    <!-- Demo Tour Overlay -->
    <div id="demo-tour" class="demo-tour hidden">
        <div class="tour-backdrop"></div>
        <div class="tour-step" data-step="1">
            <div class="tour-content">
                <h3>Willkommen zur CorrespExplorer Demo</h3>
                <p>Dieser Datensatz zeigt ein fiktives europaeisches Gelehrtennetzwerk (1880-1920) mit 35 Briefen zwischen 7 Wissenschaftlern.</p>
                <p>Die Demo demonstriert alle Funktionen von CorrespExplorer.</p>
                <div class="tour-nav">
                    <button class="tour-skip">Ueberspringen</button>
                    <button class="tour-next">Tour starten</button>
                </div>
            </div>
        </div>
        <div class="tour-step" data-step="2">
            <div class="tour-content" data-target=".view-switcher">
                <h3>Ansichten wechseln</h3>
                <p>Mit diesen Buttons wechseln Sie zwischen verschiedenen Visualisierungen: Karte, Korrespondenten, Briefe, Timeline, Themen, Orte und Netzwerk.</p>
                <div class="tour-nav">
                    <button class="tour-prev">Zurueck</button>
                    <button class="tour-next">Weiter</button>
                </div>
            </div>
        </div>
        <div class="tour-step" data-step="3">
            <div class="tour-content" data-target=".sidebar-section:first-child">
                <h3>Datensatz-Uebersicht</h3>
                <p>Hier sehen Sie Statistiken zum Datensatz: Anzahl der Briefe, Korrespondenten, Orte und den Zeitraum.</p>
                <div class="tour-nav">
                    <button class="tour-prev">Zurueck</button>
                    <button class="tour-next">Weiter</button>
                </div>
            </div>
        </div>
        <div class="tour-step" data-step="4">
            <div class="tour-content" data-target="#timeline-range-wrapper">
                <h3>Zeitraum filtern</h3>
                <p>Mit dem Timeline-Slider koennen Sie den Zeitraum einschraenken. Alle Ansichten werden automatisch aktualisiert.</p>
                <div class="tour-nav">
                    <button class="tour-prev">Zurueck</button>
                    <button class="tour-next">Weiter</button>
                </div>
            </div>
        </div>
        <div class="tour-step" data-step="5">
            <div class="tour-content" data-target=".filter-section">
                <h3>Filter anwenden</h3>
                <p>Suchen Sie nach Personen, Orten oder Themen. Die Filter lassen sich kombinieren und werden in der Sidebar angezeigt.</p>
                <div class="tour-nav">
                    <button class="tour-prev">Zurueck</button>
                    <button class="tour-next">Weiter</button>
                </div>
            </div>
        </div>
        <div class="tour-step" data-step="6">
            <div class="tour-content" data-target="#map-container">
                <h3>Interaktive Karte</h3>
                <p>Die Karte zeigt Briefe nach Absendeort. Klicken Sie auf Marker fuer Details. Die Legende erklaert die Farben (nach Sprache).</p>
                <div class="tour-nav">
                    <button class="tour-prev">Zurueck</button>
                    <button class="tour-next">Weiter</button>
                </div>
            </div>
        </div>
        <div class="tour-step" data-step="7">
            <div class="tour-content">
                <h3>Unsicherheiten visualisieren</h3>
                <p>CorrespExplorer zeigt unsichere Daten transparent an:</p>
                <ul>
                    <li>Eckige Klammern [Name] = unsichere Person</li>
                    <li>Kalender-Icon = nur Jahr/Monat bekannt</li>
                    <li>Fragezeichen = unsichere Datierung</li>
                    <li>Zeitraum-Pfeile = notBefore/notAfter</li>
                </ul>
                <div class="tour-nav">
                    <button class="tour-prev">Zurueck</button>
                    <button class="tour-next">Weiter</button>
                </div>
            </div>
        </div>
        <div class="tour-step" data-step="8">
            <div class="tour-content">
                <h3>Viel Spass beim Erkunden</h3>
                <p>Probieren Sie die verschiedenen Ansichten aus: Das Netzwerk zeigt Verbindungen zwischen Personen, die Timeline die zeitliche Verteilung, und die Themen-Ansicht verschlagwortete Inhalte.</p>
                <div class="tour-nav">
                    <button class="tour-finish">Tour beenden</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <script src="https://unpkg.com/nouislider@15.7.1/dist/nouislider.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    <script src="js/explore.js" type="module"></script>
</body>
</html>
