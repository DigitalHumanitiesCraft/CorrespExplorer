{
  "meta": {
    "generated": "2025-11-03",
    "description": "Data provenance mapping for HerData fields",
    "purpose": "Documents the source of each data field for review and validation"
  },
  "field_mappings": {
    "id": {
      "source_files": ["ra_ndb_main.xml"],
      "xpath": "//ITEM/ID",
      "description": "Person ID from SNDB database",
      "phase": 1,
      "transformation": "Direct extraction, no transformation"
    },
    "name": {
      "source_files": ["ra_ndb_main.xml"],
      "xpath": "//ITEM[LFDNR='0']/VORNAMEN and //ITEM[LFDNR='0']/NACHNAME",
      "description": "Display name constructed from first names and last name",
      "phase": 1,
      "transformation": "f'{vornamen} {nachname}'",
      "example": "Johanna Christiana Sophia Vulpius"
    },
    "gnd": {
      "source_files": ["ra_ndb_indiv.xml"],
      "xpath": "//ITEM/GND_NR",
      "description": "GND (Gemeinsame Normdatei) identifier",
      "phase": 1,
      "transformation": "Extract numeric ID from GND field",
      "coverage": "60.3% (270 of 448 women)",
      "note": "Not all persons have GND IDs"
    },
    "dates": {
      "birth": {
        "source_files": ["ra_ndb_datierungen.xml"],
        "xpath": "//ITEM[ART='Geburtsdatum']/JAHR",
        "description": "Birth year extracted from dating records",
        "phase": 1,
        "transformation": "Extract year, validate range 1700-1900"
      },
      "death": {
        "source_files": ["ra_ndb_datierungen.xml"],
        "xpath": "//ITEM[ART='Sterbedatum']/JAHR",
        "description": "Death year extracted from dating records",
        "phase": 1,
        "transformation": "Extract year, validate range 1700-1900"
      }
    },
    "places": {
      "name": {
        "source_files": ["geo_main.xml"],
        "xpath": "//ITEM[LFDNR='0']/BEZEICHNUNG",
        "description": "Place name from geodata database",
        "phase": 3,
        "note": "Uses SNDB geodata (old), linked via SNDB_ID from ra_ndb_orte.xml"
      },
      "type": {
        "source_files": ["ra_ndb_orte.xml"],
        "xpath": "//ITEM/ART",
        "description": "Place type: Wirkungsort, Geburtsort, Sterbeort, Wohnort",
        "phase": 3,
        "values": ["Wirkungsort", "Geburtsort", "Sterbeort", "Wohnort"]
      },
      "coordinates": {
        "source_files": ["geo_indiv.xml"],
        "xpath": "//ITEM/LATITUDE and //ITEM/LONGITUDE",
        "description": "Geographic coordinates from SNDB geodata",
        "phase": 3,
        "transformation": "Convert to decimal degrees",
        "coverage": "50.7% (227 of 448 women)"
      },
      "priority": {
        "source_files": ["Calculated"],
        "description": "Priority for map display: Wirkungsort(1) > Geburtsort(2) > Sterbeort(3) > Wohnort(4)",
        "phase": 3,
        "transformation": "Assigned based on place type"
      }
    },
    "occupations": {
      "source_files": ["ra_ndb_berufe.xml"],
      "xpath": "//ITEM/BERUF",
      "description": "Occupation/profession extracted from SNDB",
      "phase": 3,
      "transformation": "Direct extraction, multiple occupations possible",
      "coverage": "46.2% (207 of 448 women)"
    },
    "letter_count": {
      "source_files": ["ra-cmif.xml"],
      "xpath": "count(//correspAction[@type='sent']/persName[@ref])",
      "description": "Number of letters sent by this person to Goethe",
      "phase": 2,
      "transformation": "Count matching GND references in CMIF",
      "note": "Matches via GND ID: http://d-nb.info/gnd/{GND_NR}",
      "coverage": "51.3% (230 of 448 women have letters)"
    },
    "mention_count": {
      "source_files": ["ra-cmif.xml"],
      "xpath": "count(//correspDesc//mentionsPerson[@target])",
      "description": "Number of letters mentioning this person",
      "phase": 2,
      "transformation": "Count mentions in CMIF via GND or name matching",
      "note": "Includes both direct GND matches and fuzzy name matches"
    },
    "roles": {
      "source_files": ["Calculated from letter_count and mention_count"],
      "description": "Person's role in correspondence: sender, mentioned, indirect",
      "phase": 2,
      "transformation": "sender: letter_count > 0; mentioned: mention_count > 0; indirect: neither",
      "values": ["sender", "mentioned", "indirect"]
    },
    "role": {
      "source_files": ["Calculated from roles array"],
      "description": "Primary role for filtering (simplified)",
      "phase": 2,
      "transformation": "both if sender+mentioned, else first role"
    },
    "normierung": {
      "source_files": ["Calculated from gnd"],
      "description": "Normalization status: gnd or sndb_only",
      "phase": 1,
      "transformation": "gnd if GND_NR exists, else sndb_only"
    },
    "relations": {
      "source_files": ["ra_ndb_beziehungen.xml", "nsl_agrelon.xml"],
      "xpath": "//ITEM/BEZIEHUNG_TYP",
      "description": "AGRELON relationship types between persons",
      "phase": 3,
      "transformation": "Map SNDB relation types to AGRELON URIs",
      "coverage": "15.0% (67 of 448 women have documented relations)",
      "note": "Relations are directional: source -> target"
    },
    "biographies": {
      "source_files": [
        "projekt_regestausgabe.xml",
        "pers_koerp_projekt_goebriefe.xml",
        "pers_koerp_projekt_bug.xml",
        "pers_koerp_projekt_tagebuch.xml"
      ],
      "xpath": "//ITEM/REGISTEREINTRAG",
      "description": "Biographical texts from multiple SNDB projects",
      "phase": 4,
      "transformation": "HTML parsing, cleanup, multi-source aggregation",
      "coverage": "100% from regestausgabe, 41.7% multi-source (187 women)"
    },
    "occupation_group": {
      "source_files": ["Calculated from occupations"],
      "description": "Grouped occupation categories for filtering",
      "phase": 3,
      "transformation": "Map individual occupations to groups: artistic, literary, musical, court, education, other, none",
      "values": ["artistic", "literary", "musical", "court", "education", "other", "none"]
    },
    "letter_years": {
      "source_files": ["ra-cmif.xml"],
      "xpath": "//correspAction[@type='sent']/date/@when",
      "description": "Array of years in which person sent letters",
      "phase": 2,
      "transformation": "Extract years from ISO dates, deduplicate",
      "note": "Used for temporal filtering"
    }
  },
  "pipeline_phases": {
    "phase1": {
      "name": "Identify Women",
      "input": ["ra_ndb_main.xml", "ra_ndb_indiv.xml", "ra_ndb_datierungen.xml"],
      "output": "women dict with id, name, gnd, dates",
      "duration": "~2 seconds"
    },
    "phase2": {
      "name": "Match CMIF Letters",
      "input": ["ra-cmif.xml", "women from phase1"],
      "output": "letter_count, mention_count, roles, letter_years",
      "duration": "~5 seconds",
      "note": "15,312 letters processed"
    },
    "phase3": {
      "name": "Enrich Geodata & Metadata",
      "input": [
        "ra_ndb_orte.xml",
        "geo_main.xml",
        "geo_indiv.xml",
        "ra_ndb_berufe.xml",
        "ra_ndb_beziehungen.xml"
      ],
      "output": "places, occupations, relations, occupation_group",
      "duration": "~3 seconds"
    },
    "phase4": {
      "name": "Generate JSON & Biographies",
      "input": ["projekt_*.xml", "women from phase1-3"],
      "output": "persons.json",
      "duration": "~2 seconds"
    }
  },
  "data_quality_notes": {
    "gnd_coverage": "60.3% have GND IDs (improved from 34.1% in old SNDB)",
    "geodata_coverage": "50.7% have coordinates (hybrid approach: new export + old SNDB geodata)",
    "letter_coverage": "51.3% appear in CMIF correspondence",
    "biography_coverage": "100% have basic biography (regestausgabe), 41.7% have multi-source biographies",
    "relation_coverage": "15.0% have documented AGRELON relations",
    "known_issues": [
      "218 women without places (no geodata or unresolvable SNDB_ID)",
      "178 women without GND (fuzzy name matching used for CMIF)",
      "241 women without occupations",
      "Geburts-/Sterbeorte sometimes identical to Wirkungsort (person lived entire life in one place)"
    ]
  },
  "validation": {
    "phase1_checks": [
      "Total women: 400-500 (expected ~448)",
      "GND coverage: 50-70%",
      "Date coverage: >50%"
    ],
    "phase2_checks": [
      "Women with letters: >200",
      "Senders identified: >100"
    ],
    "phase3_checks": [
      "Geodata coverage: 40-70%",
      "Occupations: >150"
    ],
    "phase4_checks": [
      "JSON valid",
      "All required fields present",
      "Output file size: ~0.29 MB"
    ]
  }
}
